<!DOCTYPE html>
<html>
    <head>
        <title>Geopost Energy Prova</title>
    </head>
    <body>
        <h1>Gerar os grupos</h1>

        <button onclick="chooseGroup()">Gerar grupos</button>

        <p id="grupos"></p>

        <h2>Gerar as partidas</h2>
        <button onclick="gerarPartidas()">Gerar partidas</button>
        <p id="partidas"></p>

        <h3>Ver classificados</h3>
        <button onclick="classificados()">Classificação</button>
        <p id="classificados"></p>

        <script>
            const URL_FETCH = 'https://estagio.geopostenergy.com/WorldCup/GetAllTeams';

            var teams = new Array();
            const groups = {A:[],B:[],C:[],D:[],E:[],F:[],G:[],H:[]};
            
            var classficadosGrupo = new Array();
            var criterios = new Array();

            fetch(URL_FETCH,{method: 'get',headers: new Headers({'git-user':'brunodf05'})})
            .then(function(response){
                response.json().then(function(data){
                    console.log(data);
                    for (var key in data.Result){
                        teams.push(data.Result[key]);
                    }
                    console.log(teams);
                })
            });

            function shuffle(a){
                var rand,count,temp;
                count = a.length;
                while(count!=0){
                    rand = Math.floor(Math.random() * count);
                    count--;
                    temp = a[count];
                    a[count] = a[rand];
                    a[rand] = temp;
                }
            }

            function chooseGroup(){
                shuffle(teams);
                
                let y = 0; 
                let i=0;
                for (var key in groups){
                    while (y<4){
                        groups[key].push(teams[i].Name);
                        y++;
                        i++;
                    }
                    y=0;
                }
                
                let text = "<table border='1'><tr><th>Grupo A</th><th>Grupo B</th><th>Grupo C</th><th>Grupo D</th><th>Grupo E</th><th>Grupo F</th><th>Grupo G</th><th>Grupo H</th></tr>";
                console.log(groups);
                let count = 0;
                let init = groups;

                for (var n=0;n<4;n++) {
                    for (var key in groups) {
                        if (count<8){
                            if (count==0){
                                text+="<tr>";
                            }
                            let aux = groups[key];
                            text+="<td>" + aux[n] + "</td>";
                            count++;
                        }
                        if (count==8) {
                            text+="</tr>";
                            count = 0;
                        }
                    }
                }
                
                text+="</table>";
                document.getElementById("grupos").innerHTML = text;
            }

            function fillCriterios(aux,x1,x2,x3,x4,y1,y2,y3,y4,z1,z2,z3,z4){
                let time1 = aux[0];
                let time2 = aux[1];
                let time3 = aux[2];
                let time4 = aux[3];
                
                if(x1>x2){
                    criterios.find((c,i) => {
                        if (c.Name===time1){
                            criterios[i].Pontos+=3;
                            criterios[i].Saldo+=x1;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time2){
                            criterios[i].Saldo+=x2;
                            return true;
                        }
                    });
                } 
                else if (x1=x2) {
                    criterios.find((c,i) => {
                        if (c.Name===time1){
                            criterios[i].Pontos+=1;
                            criterios[i].Saldo+=x1;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time2){
                            criterios[i].Pontos+=1;
                            criterios[i].Saldo+=x2;
                            return true;
                        }
                    });
                } 
                else {
                    criterios.find((c,i) => {
                        if (c.Name===time1){
                            criterios[i].Saldo+=x1;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time2){
                            criterios[i].Pontos+=3;
                            criterios[i].Saldo+=x2;
                            return true;
                        }
                    });
                }
                if(x3>x4){
                    criterios.find((c,i) => {
                        if (c.Name===time3){
                            criterios[i].Pontos+=3;
                            criterios[i].Saldo+=x3;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time4){
                            criterios[i].Saldo+=x4;
                            return true;
                        }
                    });
                } 
                else if (x3=x4) {
                    criterios.find((c,i) => {
                        if (c.Name===time3){
                            criterios[i].Pontos+=1;
                            criterios[i].Saldo+=x3;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time4){
                            criterios[i].Pontos+=1;
                            criterios[i].Saldo+=x4;
                            return true;
                        }
                    });
                } 
                else {
                    criterios.find((c,i) => {
                        if (c.Name===time3){
                            criterios[i].Saldo+=x3;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time4){
                            criterios[i].Pontos+=3;
                            criterios[i].Saldo+=x4;
                            return true;
                        }
                    });
                }
                if(y1>y2){
                    criterios.find((c,i) => {
                        if (c.Name===time1){
                            criterios[i].Pontos+=3;
                            criterios[i].Saldo+=y1;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time3){
                            criterios[i].Saldo+=y2;
                            return true;
                        }
                    });
                } 
                else if (y1=y2) {
                    criterios.find((c,i) => {
                        if (c.Name===time1){
                            criterios[i].Pontos+=1;
                            criterios[i].Saldo+=y1;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time3){
                            criterios[i].Pontos+=1;
                            criterios[i].Saldo+=y2;
                            return true;
                        }
                    });
                } 
                else {
                    criterios.find((c,i) => {
                        if (c.Name===time1){
                            criterios[i].Saldo+=y1;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time3){
                            criterios[i].Pontos+=3;
                            criterios[i].Saldo+=y2;
                            return true;
                        }
                    });
                }
                if(y3>y4){
                    criterios.find((c,i) => {
                        if (c.Name===time2){
                            criterios[i].Pontos+=3;
                            criterios[i].Saldo+=y3;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time4){
                            criterios[i].Saldo+=y4;
                            return true;
                        }
                    });
                } 
                else if (y3=y4) {
                    criterios.find((c,i) => {
                        if (c.Name===time2){
                            criterios[i].Pontos+=1;
                            criterios[i].Saldo+=y3;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time4){
                            criterios[i].Pontos+=1;
                            criterios[i].Saldo+=y4;
                            return true;
                        }
                    });
                } 
                else {
                    criterios.find((c,i) => {
                        if (c.Name===time2){
                            criterios[i].Saldo+=y3;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time4){
                            criterios[i].Pontos+=3;
                            criterios[i].Saldo+=y4;
                            return true;
                        }
                    });
                }
                if(z1>z2){
                    criterios.find((c,i) => {
                        if (c.Name===time1){
                            criterios[i].Pontos+=3;
                            criterios[i].Saldo+=z1;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time4){
                            criterios[i].Saldo+=z2;
                            return true;
                        }
                    });
                } 
                else if (z1=z2) {
                    criterios.find((c,i) => {
                        if (c.Name===time1){
                            criterios[i].Pontos+=1;
                            criterios[i].Saldo+=z1;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time4){
                            criterios[i].Pontos+=1;
                            criterios[i].Saldo+=z2;
                            return true;
                        }
                    });
                } 
                else {
                    criterios.find((c,i) => {
                        if (c.Name===time1){
                            criterios[i].Saldo+=z1;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time4){
                            criterios[i].Pontos+=3;
                            criterios[i].Saldo+=z2;
                            return true;
                        }
                    });
                }
                if(z3>z4){
                    criterios.find((c,i) => {
                        if (c.Name===time2){
                            criterios[i].Pontos+=3;
                            criterios[i].Saldo+=z3;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time3){
                            criterios[i].Saldo+=z4;
                            return true;
                        }
                    });
                } 
                else if (z3=z4) {
                    criterios.find((c,i) => {
                        if (c.Name===time2){
                            criterios[i].Pontos+=1;
                            criterios[i].Saldo+=z3;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time3){
                            criterios[i].Pontos+=1;
                            criterios[i].Saldo+=z4;
                            return true;
                        }
                    });
                } 
                else {
                    criterios.find((c,i) => {
                        if (c.Name===time2){
                            criterios[i].Saldo+=z3;
                            return true;
                        }
                    });
                    criterios.find((c,i) => {
                        if (c.Name===time3){
                            criterios[i].Pontos+=3;
                            criterios[i].Saldo+=z4;
                            return true;
                        }
                    });
                }
                
            }

            function classificados(){
                
                for(var key in groups){
                    var aux = groups[key];
                    var i=0;
                    var first = {
                        name : [],
                        pontos: 0
                    };
                    var second = {
                        name : [],
                        pontos: 0
                    };
                    var tmp =[];
                    while(i<4){
                        if (first.name.length === 0){
                            first.name = aux[i];
                            let pnt = criterios.find(c => c.Name === aux[i]);
                            first.pontos = pnt.Pontos;
                        }
                        else {
                            let pnt1 = criterios.find(c => c.Name === first.name);
                            let pnt2 = criterios.find(c => c.Name === aux[i]);
                            if (pnt1.Pontos<pnt2.Pontos){
                                second.name = first.name;
                                second.pontos = pnt1.Pontos;
                                first.name = aux[i];
                                first.pontos = pnt2.Pontos;
                            } else if (second.name.length === 0){
                                second.name = aux[i];
                                second.pontos = pnt2.Pontos;
                            } else {
                                pnt1 = criterios.find(c => c.Name === second.name);
                                
                                if (pnt1.Pontos<pnt2.Pontos){
                                    second.name = aux[i];
                                    second.pontos = pnt2.Pontos;
                                }
                            }
                        }
                        i++;
                    }

                    classficadosGrupo.push({
                        [key] : {
                            first,
                            second 
                        }
                    });
                }

                let text = '<table border="1" style="width:100%"><tr><th></th><th>Classificados em primeiro</th><th>Classficados em segundo</th>';
                for(var i=0;i<8;i++){
                    let tmp = classficadosGrupo[i];
                    for(var key in tmp){
                        text+= '<tr><th>Grupo ' + key + '</th>';
                        let aux = tmp[key];
                        text+= '<td>'+aux.first.name+' '+aux.first.pontos+' Pontos</td><td>'+aux.second.name+' '+aux.second.pontos+' Pontos</td>';
                    }
                }
                text+='</table>'
                document.getElementById("classificados").innerHTML = text;
                console.log("CLASSIFICADOS GRUPOS",classficadosGrupo);
            }

            function gerarPartidas(){
                for (var i=0; i<teams.length;i++){
                    criterios.push({
                        "Name": teams[i].Name,
                        "Pontos": 0,
                        "Saldo": 0,
                    });
                }
               
                let text = '<table border="1" style="width:100%"><tr><th></th><th>Rodada 1 - Jogo 1</th><th>Rodada 1 - Jogo 2</th><th>Rodada 2 - Jogo 1</th><th>Rodada 2 - Jogo 2</th><th>Rodada 3 - Jogo 1</th><th>Rodada 3 - Jogo 2</th>';
                for(var key in groups){
                    text += '<tr><th>Partidas Grupo '+key+"</th>";
                    let x1=Math.floor(Math.random()*4),
                    x2=Math.floor(Math.random()*4),
                    x3=Math.floor(Math.random()*4),
                    x4=Math.floor(Math.random()*4),
                    y1=Math.floor(Math.random()*4),
                    y2=Math.floor(Math.random()*4),
                    y3=Math.floor(Math.random()*4),
                    y4=Math.floor(Math.random()*4),
                    z1=Math.floor(Math.random()*4),
                    z2=Math.floor(Math.random()*4),
                    z3=Math.floor(Math.random()*4),
                    z4=Math.floor(Math.random()*4);

                    let aux = groups[key];
                    text+="<td>"+aux[0]+" "+x1+" x "+x2+" "+aux[1]+"</td>";
                    text+="<td>"+aux[2]+" "+x3+" x "+x4+" "+aux[3]+"</td>";
                    text+="<td>"+aux[0]+" "+y1+" x "+y2+" "+aux[2]+"</td>";
                    text+="<td>"+aux[1]+" "+y3+" x "+y4+" "+aux[3]+"</td>";
                    text+="<td>"+aux[0]+" "+z1+" x "+z2+" "+aux[3]+"</td>";
                    text+="<td>"+aux[1]+" "+z3+" x "+z4+" "+aux[2]+"</td>";

                    fillCriterios(aux,x1,x2,x3,x4,y1,y2,y3,y4,z1,z2,z3,z4)
                    
                    

                }
                text+="</table>";
                console.log("CRITERIOS",criterios)
                document.getElementById("partidas").innerHTML = text;

            }


        </script>        
    </body>
</html>